## CHAPTER 7 아키텍처 특성 범위

```
논의내용없음)
아키텍처 퀀텀이라는 새로운 용어 때문에 어렵긴 했는데, 또 이번 기회에 배우는 게 계속해서 있다는 점에서 겸손해지고 있습니다.

유일하게 이 챕터에서 논의 주제를 뽑을 수가 없네요. 겸손하게 배우는 챕터로 넘어가야 할 것 같습니다.
```

소프트웨어 아키텍처 세계에서는 전통적으로 아키텍처 특성의 범위를 시스템 레벨에 두는 것을 당연시했다. 하지만 현대적인 공학 기술의 등장과 마이크로서비스 등의 아키텍처 스타일이 가능해지면서 아키텍처 특성의 범위는 상당히 좁아졌다.

아키텍트가 성능이 좋고 탄력적인 코드베이스를 설계하려고 아무리 노력해도 시스템이 그런 특성에 부합하지 않는 데이터베이스를 사용하면 애플리케이션이 성공할 수 없다.

아키텍트는 운영 아키텍처 특성을 따져보고 아키텍처 특성에 영향을 미치는 코드베이스 외부의 컴포넌트의 의존성을 측정하기 위해 <Building Evolutionary Architecture>의 저자들은 아키텍처 퀀텀이라는 용어를 정의했다. 이 전에 먼저 커네이선스라는 핵심 메트릭을 이해해야 한다.

### 7.1 커플링과 커네이선스

1996년 밀러 페이지-존스는 <What Every Programmer Should Know About Object Oriented Design>이라는 책에서 커네이선스라는 새로운 커플링 메트릭을 소개한다.

#### 커네이선스

두 컴포넌트 중 한쪽이 변경될 경우 다른 쪽도 변경해야 전체 시스템의 정합성이 맞는다면 이들은 커네이선스를 갖고 있는 것이다.

아키텍처 퀀텀을 정의하려면 컴포넌트가 어떻게 서로 '연결되어wired' 있는지 측정할 방법이 필요한데, 이것이 바로 커네이선스라는 개념이다.

### 7.2 아키텍처 퀀텀과 세분도

성공적으로 소프트웨어를 설계, 분석, 발전시키기 위해 개발자는 문제가 될만한 커플링 지점을 모두 살펴봐야 한다. 

#### 아키텍처 퀀텀

높은 기능 응집도high funtional cohesion와 동기적 커네이선스synchronous connascence를 가진, 독립적으로 배포 가능한independently deployable 아티팩트

#### 독립적으로 배포 가능

아키텍처 퀀텀은 아키텍처의 다른 파트와 독립적으로 작동되는 모든 필수 컴포넌트를 포함한다.
데이터베이스를 사용하는 애플리케이션은 데이터베이스 없이는 작동되지 않으므로 데이터베이스는 퀀텀의 일부이다.

#### 높은 기능 응집도

응집도는 컴포넌트 설계에 따라 구현된 코드가 얼마나 목적에 맞게 통합되어 있는지를 나타낸다.
Customer 컴포넌트는 고객 엔티티와 관련된 모든 프로퍼트와 메서드를 가지고 있으므로 응집도가 높지만
Utility 컴포넌트는 여러 가지 잡다한 메서드를 무작위로 섞어 놓아서 응집도가 낮은 편이다.

기능 응집도가 높다는 건 아키텍처 퀀텀이 목적에 맞는 뭔가를 하고 있다는 뜻이다.

#### 동기적 커네이선스

아키텍처 퀀텀을 형성하는 애플리케이션 콘텍스트 내부 또는 분산 서비스 간의 동기 호출을 의미한다. 동기 호출은 호출의 길이에 대해 동적 커네이선스를 만들어낸다. 호출하는 쪽이 다른 쪽을 기다린다면 양쪽의 운영 아키텍처 특성이 동일해야 한다.

**도메인 주도 설계의 경계 콘텍스트**

> 에릭 에반스Eric Evans의 <도메인 주도 설계>는 현대 아키텍처 사고 방식에 지대한 영향을 미친 책이다. 도메인 주도 설계는 복잡한 문제 도메인을 체계적으로 분해하는 모델링 기법이다.
각 엔티티는 로컬 콘텍스트 내부에서 가장 잘 동작하므로 조직 전체가 함께 쓰는 통합 Customer 클래스를 만드는 대신, 각 문제 도메인에 자체 클래스를 두고 차이점은 그것을 통합하는 지점에서 조정하는 것이 경계 콘텍스트 개념이다.

현대 시스템에서 아키텍트는 시스템 레벨 보다는 퀀텀 레벨의 아키텍처 특성을 정의한다. 중요 운영 관심사에 대해 중요한 아키텍처 문제를 조기에 발견하여 하이브리드 아키텍처를 설계할 수 있다.

#### 7.2.1 사례 연구: GGG(Going, Going, Gone)

온라인 경매 회사의 아키텍처 카타

**설명**

- 이 경매 회사는 온라인 경매 시장을 전국적으로 확장하려고 한다. 고객이 참여할 경매를 선택하고 기다 렸다가 경매가 시작되면 마치 처음부터 경매인과 같은 공간에 있었던 것처럼 입찰을 시작한다.

**유저**

- 경매 당 참여자는 수백 명, 어쩌면 수천 명까지 늘어날 수 있고 많은 동시 경매가 이루어질 것이다.

**요구사항**

- 경매는 가급적 실시간 처리가 가능해야 한다.
- 입찰자는 낙찰 시 자동 결제할 신용카드를 등록한다.
- 입찰자는 평판 지수 reputation index 로 추적되어야 한다.
- 입찰자는 라이브 동영상 스트림을 시청하면서 발생하는 모든 입찰을 볼 수 있어야 한다.
- 온라인/라이브 입찰 모두 입찰이 일어난 순서대로 접수되어야 한다.

**부가 콘텍스트**

- 이 경매 회사는 공격적으로 규모가 상대적으로 작은 경쟁사를 인수 합병하여 사세를 키우고 있다.
- 예산 제한은 따로 없다. 전략적으로 그렇게 결정됐다.
- 이 회사는 위조 혐의로 고발된 소송에서 이제 막 벗어났다.

아키텍트는 각 요구사항을 꼼꼼히 검토해서 아키텍처 특성을 찾아내야 한다.

1. '전국적인 확장', '경매 당 참여자는 수백 명, 수천 명 까지 동시 경매가 이루어진다', '경매는 실시간 처리가 가능해야 한다'

유저 수를 지원하는 확장성과 폭주하는 트래픽을 지원하는 탄력성이 필요.
아키텍트가 암묵적인 아키텍처 특성을 집어내려면 도메인 지식이 매우 중요하다.

2. '입찰자는 낙찰 시 자동 결제할 신용카드를 등록한다', '이 회사는 위조 혐의로 고발된 소송에서 이제 막 벗어났다'

이 두 요구사항은 보안이라는 아키텍처 특성을 분명하게 가리킨다.
과거에 위조에 관련된 보안 문제가 있는 것으로 판단이 되므로 설계 시 빠진 것은 없는지 꼼꼼히 짚어봐야 한다.

3. '입찰자는 평판 지수로 추적되어야 한다'

뭔가를 '추적' 한다는 것은 감시성, 로그성 같은 아키텍처 특성을 의미한다. 아키텍트는 도메인에서 미처 다루지 못한 구조적 영향을 끼칠 만한 요구사항이 있는지 찾아봐야 한다.

4. '이 경매 회사는 공격적으로 규모가 상대적으로 작은 경쟁사를 인수 합병하여 사세를 키우고 있다'

설계에 직접적인 영향은 주지 않지만, 트레이드오프를 고려해 볼 때 결정 팩터가 될 수 있다.

5. '예산 제한은 따로 없다. 전략적으로 그렇게 결정했다'

아키텍트는 더욱 정교하고 목적이 특화된 아키텍처를 선정할 수 있다.

6. 입찰자는 라이브 동영상 스트림을 시청하면서 발생하는 모든 입찰을 볼 수 있어야 한다', '온라인/라이브 입찰 모두 입찰이 일어난 순서대로 접수되어야 한다'

아키텍처 특성을 시스템의 전체적인 평가로 취급하는 것이 무익함을 잘 보여주는, 흥미로운 아키텍처 난제이다.

GGG에서 발견한 퀀텀과 아키텍처 특성은 다음과 같다

- 입찰자 피드백: 입찰 스트림과 입찰 동영상 스트림을 포함한다.
  - 가용성
  - 확장성
  - 성능
- 경매인: 라이브 캠페인
  - 가용성
  - 신뢰성
  - 확장성
  - 탄력성
  - 성능
  - 보안
- 입찰자: 온라인 입찰자와 입찰
  - 신뢰성
  - 가용성
  - 확장성
  - 탄력성