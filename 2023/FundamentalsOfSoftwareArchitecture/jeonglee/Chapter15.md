## 15. 공간 기반 아키텍처 스타일

웹 기반 비즈니스 애플리케이션은 대부분 일반적인 요청 흐름을 따라간다.

브라우저에서 요청을 보내면 웹 서버, 애플리케이션 서버, 데이터베이스 서버 순서로 도달한다.

이런 패턴은 유저가 많지 않으면 별 문제없지만 유저 수가 늘어나면 점점 병목 현상이 나타나기 시작한다.

처음에는 웹 서버 레이어에서 발생하다가 나중에는 애플리케이션, 데이터베이스 서버 레이어에서도 발생한다.

유저 수 증가에 따른 병목 현상의 가장 일반적인 해결 방법은 웹 서버 확장이다.

이 방법은 비교적 쉽고 저렴하며 효과적으로 병목을 제거할 수 있지만, 유저 부하가 높을 때 웹 서버 레이어를 확장하면 병목점은 다시 애플리케이션 서버로 이동하기 쉽다.

애플리케이션 서버 확장은 웹 서버보다 휠씬 복잡하고 비용도 많이 드는데, 문제는 그렇게 확장 하더라도 다시 데이터베이스 서버가 병목점이 될 가능성이 높다는 것이다..

공간 기반 아키텍처 스타일은 높은 확장성, 탄력성, 동시성 및 이와 관련된 문제를 해결하기 위해 설계된 아키텍처 스타일이다.

동시 유저 수가 매우 가변적이라서 예측조차 곤란한 애플리케이션에서도 유용하다.

극단적이고 가변적인 확장성 문제는 데이터 베이스를 확장하거나, 확장성이 떨어지는 아키텍처에 맞게 캐시 기술을 적용하는 것보다 아키텍처적으로 해결하는 것이 낫다.

### 15.1 토폴리지

공간 기반 아키텍처라는 명칭은 튜플 공간에서 유래되었으며, 튜플 공간이란 공유 메모리를 통해 통신하는 다중 병렬 프로세서를 사용하는 기술이다.

시스템에서 동기 제약조건인 중앙 데이터베이스를 없애는 대신, 복제된 인메모리 데이터 그리드를 활용하면 확장성, 탄력성, 성능을 높일 수 있다.

애플리케이션 데이터는 메모리에 둔 상태로 모든 활성 처리 장치들이 데이터를 복제한다.

처리 장치는 데이터를 업데이트할 때 퍼시스턴스 큐에 메시지를 보내는 식으로 데이터베이스에 데이터를 비동기 전송한다.

따라서 유저 부하의 증가/감소에 따라 처리 장치는 동적으로 시작/종료할 수 있어 가변적으로 확장할 수 있다.

중앙 데이터베이스가 애플리케이션의 표준 트랜잭션 처리에 관여하지 않으므로 데이터베이스 병목 현상이 사라지고 애플리케이션은 거의 무한에 가까운 확장성이 보장된다.

공간 기반 아키텍처는 애플리케이션 코드가 구현된 처리 장치, 처리 장치를 관리/조정하는 가상 미들웨어, 업데이트된 데이터를 데이터베이스에 비동기 전송하는 데이터 펌프, 데이터 펌프에서 데이터를 받아 업데이트를 수행하는 데이터 라이터, 처리 장치가 시작되자마자 데이터베이스의 데이터를 읽어 전달하는 데이터 리더컴포넌트로 구성된다.

*매우 복잡..*

#### 15.1.1 처리 장치

처리 장치는 애플리케이션 로직을 갖고 있다.

보통은 웹 기반 컴포넌트와 백엔드 비즈니스 로직이 포함되나 애플케이션 종류마다 내용물은 달라진다.

작은 웹 기반 애플리케이션은 단일 처리 장치에 배포할 수 있지만, 대규모 애플리케이션은 기능별로 여러 처리 장치에 나누어 배포해야 한다.

#### 15.1.2 가상 미들웨어

가싱 미들웨어는 아키텍처 내부에서 데이터 동기화 및 요청 처리의 다양한 부분을 제어하는 인프라를 담당한다.

가상 미들웨어는 메시징 그리드, 데이터 그리드, 처리 그리드, 배포 관리자등의 컴포넌트로 구성된다.

- 메시징 그리드
  - 입력 요청과 세션 상태를 관리한다.
  - 가상 미들웨어에 요청이 유입되면 메시징 그리드는 어느 활성 처리 장치가 요청을 받아 처리할지 결정하여 해당 처리 장치로 요청을 전달한다.
- 데이터 그리드
  - 데이터는 이름이 동일한 데이터 그리드가 포함된 차리 장치 간에 동기화된다.
- 처리 그리드
  - 다수의 처리 장치가 단일 비즈니스 요청을 처리할 경우 요청 처리를 오케스트레이트하는 일을 한다.
  - 또 종류가 다른 처리 장치 사이에 조정이 필요한 요청이 들어오면 처리 그리드가 이를 처리한다.
- 배포 관리자
  - 부하 조건에 따라 처리 장치 인스턴스를 동적으로 시작/종료하는 컴포넌트이다.

#### 15.1.3 데이터 펌프

데이터 펌프란, 데이터를 다른 프로세서에 보내 데이터베이스를 업데이트하는 장치이다.

공간 기반 아키텍처에서는 처리 장치가 데이터를 데이터베이스에 직접 읽고 쓰지 않으므로 데이터 펌프가 필요하다.

데이터 펌프는 항상 비동기적으로 동작하며 메모리캐시와 데이터베이스의 최종 일관성을 보장한다.

#### 15.1.4 데이터 라이터

데이터 라이터란, 데이터 펌프에서 메시지를 받아 그에 맞게 데이터베이스를 업데이트하는 컴포넌트이다.

데이터 라이터는 서비스나 애플리케이션, 데이터 허브로 구현할 수 있다.

#### 15.1.5 데이터 리더

데이터 라이터가 데이터베이스 업데이트를 담당한다면 데이터 리더는 데이터베이스에서 데이터를 읽어 리버스 데이터 펌프를 통해 처리 장치로 실어 나르는 컴포넌트이다.

### 15.2 데이터 충돌

이름이 동일한 캐시가 포함된 인스턴스에 시시각각 업데이트가 일어나는 active/acitve 상태에서 복제 캐시를 사용하면 복제 레이턴시때문에 데이터 충돌이 발생할 수 있다.

### 15.3 클라우드 대 온프레미스 구현

공간 기반 아키텍처는 배포 환경 측면에서 독자적인 선택지가 있다.

처리 장치, 가상 미들웨어, 데이터 펌프, 데이터 리더/라이타, 데이터 베이스 등 전체 토폴로지는 클라우드 기반의 환경이나 온프레미스에 배포할 수 있다.

하지만 이 두 환경 사이에 어중간하게 배포할 수 있는데, 이것이 다른 아키텍처 스타일에서는 찾아볼 수 없는 이 아키텍처의 특징이다.

### 15.4 복제 캐시 대 분산 캐시  

공간 기반 아키텍처는 캐시 기술을 활용하여 애플리케이션 트랜잭션을 처리하고 데이터베이스에 직접 읽기/쓰기를 할 필요가 있어서 확장성, 탄력성, 성능이 우수하다.

대부분의 공간 기반 아키텍처는 복제 캐시도 사용할 수 있다.

### 15.5 니어 캐시

니어 캐시는 분산 캐시와 인 메모리 데이터 그리드를 접합한 일종의 하이브리드 캐시 모델이다.

### 15.7 아키텍처 특성 등급

공간 기반 아키텍처는 확장성, 탄력성, 성능의 끝판왕이다..!

이 아키텍처튼 인메모리 데이터 캐시를 활용하고 제약조건에 해당되는 데이터베이스를 없앴기 때문에 이 세가지 특성을 높은 수준으로 달성할 수 있다.

이러한 강점은 전체적인 단순성과 시험성 측면에서 트레이드 오프가 발생한다.

### 느낀점

진짜 제일 이해가 안된 것 같은 챕터...ㅠㅠ

#### 논의 사항

없습니다..
