## 13. 서비스 기반 아키텍처 스타일

서비스 기반 아키텍처는 마이크로서비스 아키텍처 스타일의 일종으로 아키텍처가 유연해서 가장 실용적인 아키텍처 스타일 중 하나이다.

마이크로 서비스나 이벤트 기반 아키텍처와 마찬가지로 분산 아키텍처지만 비교적 덜 복잡하고 비용이 많이 들지 않아서 많은 비즈니스 관련 애플리케이션에 널리 채택된 아키텍처이다..!

### 13.1. 토폴로지

서비스 기반 아키텍처의 기본 토폴로지는 각각 따로 배포된 유저 인터페이스와 원격 서비스, 그리고 모놀리스 데이터베이스로 이루어진 대규모 분산 레이어 구조이다.

이 아키텍처 스타일에서 **서비스는 큼지막한 단위로 분리해 별도로 배포**하는 `애플리케이션의 일부`이다.

서비스를 배포하는 방식 자체는 여느 모놀리식 애플리케이션과 동일하므로 컨테이너화는 필수가 아니다..!

여러 서비스가 단일 모놀리식 데이터베이스를 공유하므로 애플리케이션 서비스는 다 합쳐도 4 ~ 12개 평균 7개 정도이다.

서비스 기반 아키텍처의 도메인 서비스는 각각 단일 인스턴스로 배포하지만, 확장성, 내고장성, 처리량 요구사항에 따라 인스턴스를 여럿 둘 수도 있다.

서비스는 원격 액세스 프로토콜로 유저 인터페이스 외부에서 접속할 수 있다.

서비스 기반 아키텍처는 중앙 공유 데이터 베이스를 사용한다는 특징이 중요하다.

### 13.2. 토폴로지 변형

서비스 기반 아키텍처 스타일은 특유의 유연성 때문에 정말 다양한 변형이 존재한다.

단일 모놀리식 유저 인터페이스는 다시 여러 유저 인터페이스 도메인으로 나눌 수 있고, 각 도메인 서비스에 맞게 나눌 수 있다.

또, 단일 모놀리식 데이터베이스를 개별 데이터베이스로 분리할 수 있고, 각 도메인 서비스 전용 데이터베이스들로 쪼갤 수 있다.

### 13.3. 서비스 설계 및 세분도

서비스 기반 아키텍처의 도메인 서비스는 보통 단위가 크기 때문에 도메인 서비스를 API 퍼사드 레이어, 비즈니스 레이어, 퍼시스턴스 레이어로 구성된 레이어드 아키텍처 스타일로 설계하는 것이 일반적이다.

서비스를 어떻게 설계하든 도메인 서비스는 유저 인터페이스에서 비즈니스 기능을 호출하기 위해 접속할 일종의 API 액세스 퍼사드를 필요로 한다.

*퍼사드 패턴 참고,,*

API 액세스 퍼사드는 유저 인터페이스를 통해 유입된 비즈니스 요청을 오케스트레이트하는 역할을 한다.

세분도 관점에서 내부 클래스 수준의 오케스트레이션과 외부 서비스의 오케스트레이션이라는 차이점이 서비스 기반 아키텍처와 마이크로서비스의 중요한 차이점이다.

도메인 서비스는 단위가 커서 데이터 무결성과 일관성 측면에서는 유리하지만 그에 못지않은 트레이드 오프도 있다.

### 13.4. 데이터베이스 분할

서비스 기반 아키텍처의 서비스는 주어진 애플리케이션 콘텍스트에서 서비스 수가 적은 편이라 보통 단일 모놀리식 데이터베이서를 공유한다.

그러나 이러한 데이터베이스 커플링은 테이블 스키마 변경 시 문제가 될 수 있다.

테이블 스키마를 올바르게 변경하지 않을 경우 모든 서비스에 악영향을 미치기 때문에 데이터베이스 변경은 여러모로 노력과 조정이 필요한 값비싼 작업이다.

예제와 같이 단일 공유 라이브러리를 사용하면 데이터배이스 테이블 하나를 바꿔도 모든 서비스에 양행을 미친다.

이러한 리스크를 낮추는 방법은 데이터베이스를 논리적으로 분할하고 이러한 논리 분할을 연합 공유 라이브러리를 통해 명시하는 것이다.

### 13.5. 아키텍처 예시

서비스 기반 아키텍처의 유연함을 볼 수 있다.

### 13.6. 아키텍처 특성 등급

서비스 기반 아키텍처는 도메인 분할된 아키텍처이다.

즉, 기술 관심사보다 도메인 위주로 구성된 아키텍처이고, 소프트웨어 단위로서 그 범위가 특정 도메인으로 한정된다.

따라서 나중에 해당 도메인을 변경할 일이 생겨도 해당 서비스, 해당 유저 인터페이스만 영향 받을 뿐 다른 부분을 고칠 필요가 없다..!

분산 아키텍처 이므로 퀀텀도 하나 이상을 가지며 동일한 데이터베이스나 유저 인터페이스를 공유할 경우 전체 시스템 퀀텀은 1이다.

전체적으로 5점은 없지만 평균이 매우 높다.

신속한 변경(민첩성), 도메인 범위가 한정되어 테스트 커버리지가 향상(시험성), 덩치가 큰 모놀리스보다 덜 위험하게, 더 자주 배포될 수 있다.(배포성)

내고장성, 확장성또한 분산 아키텍처의 특성이므로 높다.

### 13.7. 언제 이 아키텍처 스타일을 적용하는가

서비스 기반 아키텍처는 매우 실용적인 아키텍처이다.

이 보다 더 강력한 분산 아키텍처 스타일도 있지만! 그 강력함은 곧 가파른 비용 상승을 동반하고 그렇게 까지 강력할 필요가 없음을 알게 된다. (트레이드 오프)

서비스 기반 아키텍처는 도메인 주도 설계와 궁합이 잘 맞고 서비스를 큰 단위로 나누고 그 범위를 도메인으로 한정하기 때문에 각 도메인은 개별 배포된 도메인 서비스에 딱 맞아 떨어진다.

서비스 기반 아키텍처는 복잡하게 뒤얽히거나 세분도의 함정에 빠져 허우적거리지 않고도 아키텍처 모듈성을 괜찮은 수준으로 달성할 수 있다.

### 느낀점

분산에 들어오니 모놀리식의 연장이라고 생각되는데..(하나의 도메인 서비스를 하나의 레이어드 아키텍처로 설계한다는 부분에서) 좀 더 추상적으로 다루다 보니 이렇게 설계가 된 것 같다.

게임쪽에서 과연 이런 분산 아키텍처를 사용하는 경우가 있을까..? 라는 생각이 든다..

#### 논의사항

논외로 질문이 있습니다.. 모놀리스와 분산아키텍처를 책에서 보여주는 순서가 많이 사용되는 아키텍처 순서인가요?

++ 책에서 소개된 아키텍처 말고도 다양한 아키텍처가 있는건지..
