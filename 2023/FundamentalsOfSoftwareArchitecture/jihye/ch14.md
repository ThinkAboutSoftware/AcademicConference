# 14장, 이벤트 기반 아키텍처 스타일
- 이벤트 기반 아키텍처(event-driven architecture)는 확장성이 뛰어난 고성능 애플리케이션 개발에 널리 쓰이는 비동기 분산 아키텍처 스타일이다. 적응성이 아주 좋아서 소규모 애플리케이션부터 크고 복잡한 애플리케이션까지 두루 사용할 수 있다. 이벤트 기반 아키텍처는 이벤트를 비동기 수신/처리하는 별도의 이벤트 처리 컴포넌트들로 구성되며, 스탠드얼론 아키텍처 스타일로 사용하거나 다른 아키텍처 스타일(예: 이벤트 기반 마이크로 서비스 아키텍처)에 내장할 수도 있다.
- 애플리케이션은 대부분 요청 기반 모델(request-based model)을 따른다. 이 모델에서는 어떤 액션을 수행하도록 시스템에 요청하면 요청 오케스트레이터가 접수한다. 요청 오케스트레이터는 보통 유저 인터페이스이지만 API 레이어나 엔터프라이즈 서비스로도 구현할 수 있다. 이 컴포넌트의 임무는 다양한 요청 프로세서에 확정적으로, 동기적으로 요청을 전달하는 일이다. 요청 프로세서는 요청을 받아 데이터베이스에서 정보를 조회/수정하는 등의 작업을 수행하는 식으로 요청을 처리한다

## 14.1 토폴로지
- 이벤트 기반 아키텍처의 주요 토폴로지는 중재자 토폴로지(mediator topology)와 브로커 토폴로지(broker topology)이다. 주로 중재자 토폴로지는 이벤트 처리 워크플로를 제어해야 할 경우에, 브로커 토폴로지는 신속한 응답과 동적인 이벤트 처리 제어가 필요할 때 각각 사용된다.

## 14.2 브로커 토폴로지
- 브로커 토폴로지는 중앙에 이벤트 중재자가 없다는 점에서 중재자 토폴로지와 다르다. 메시지는 경량 메시지 브로커를 통해 브로드캐스팅되는 식으로 이벤트 프로세서 컴포넌트에 분산되어 흘러간다. 이 토폴로지는 비교적 이벤트 처리 흐름이 단순하고 굳이 중앙에서 이벤트를 조정할 필요가 없을 때 유용하다.
- 브로커 토폴로지는 네 가지 기본 아키텍처 컴포넌트, 즉 시작 이벤트, 이벤트 브로커, 이벤트 프로세서, 처리 이벤트로 구성된다.

## 14.3 중재자 토폴로지
- 중재자 토폴로지(mediator topology)는 좀 전에 살펴본 브로커 토폴로지의 단점들을 일부 보완한다. 여러 이벤트 프로세서 간의 조정이 필요한 시작 이벤트에 대하여 워크플로를 관리/제어하는 이벤트 중재자(event mediator)가 핵심이다. 중재자 토폴로지는 시작 이벤트, 이벤트 큐, 이벤트 중재자, 이벤트 채널, 이벤트 프로세서, 이렇게 5개 아키텍처 컴포넌트로 구성된다.

## 14.4 비동기 통신
- 이벤트 기반 아키텍처 스타일은(이벤트 컨슈머의 응답을 받아야 하는) 요청/응답 처리뿐만 아니라 파이어 엔드 포겟 처리 모두 비동기 통신만 사용한다는 점에서 다른 아키텍처 스타일과 차별화된다. 비동기 통신은 시스템 응답성을 전반적으로 높이는 강력한 기법으로 활용할 수 있다.

## 14.5 에러 처리
- 리액티브 아키텍처의 워크플로 이벤트 패턴은 비동기 워크플로에서 에러 처리 문제를 해결하는 한 가지 방법이다. 탄력성과 응답 이라는 두 마리 토끼를 겨냥한 리액티브 아키텍처 패턴의 일종이다.
- 워크플로 이벤트 패턴은 워크플로 대리자(workflow delegate)를 통해 위임, 봉쇄, 수리 작업을 한다. 

## 14.6 데이터 소실 방지
- 비동기 통신을 할 때 데이터 소실은 언제나 중요한 관심사인데, 불행하게도 이벤트 기반 아키텍처는 데이터가 소실될 만한 곳이 참 많다. 데이터 소실이란, 메시지가 도중에 삭제되거나 최종 목적지에 도달하지 못한 상태를 말한다. 
- 데이터 소실 문제는 기본적인 메시징으로 어느 정도 해결할 수 있다.

## 14.7 브로드 캐스팅
- 이벤트 기반 아키텍처는 메시지를 누가 받은(컨슈머가 있다면), 그 메시지로 무슨 일을 하든 상관없이 이벤트를 브로드캐스트(전파)할 수 있다.

## 14.8 요청-응답
- 서비스나 이벤트 프로세서 간에 동기 통신이 필요한 경우도 있다.
- 이벤트 기반 아키텍처는 동기 통신을 요청-응답 메시징(의사 동기 통신, psedosynchronous communication이라고도 함) 방식으로 수행한다.
- 요청-응답 메시징 내부의 각 이벤트 채널은 요청 큐, 응답 큐로 구성된다. 

## 14.9 요청 기반이냐, 이벤트 기반이냐
- 요청 기반 모델과 이벤트 기반 모델 모두 소프트웨어 시스템을 설계하는 유효한 접근 방식이다.
- 워크플로의 확장성과 제어가 중요하면 체계적인 데이터 기반의 요청에 특화된 요청 기반 모델을, 복잡하고 동적인 유저 처리 등 주로 고도의 응답성과 확장성을 요하는, 유연한 액션 단위의 이벤트를 처리한다면 이벤트 기반 모델이 좋은 선택이다.

## 14.10 하이브리드 이벤트 기반 아키텍처
- 이벤트 기반 아키텍처와 다른 아키텍처 스타일을 함께 사용하는 하이브리드 아키텍처 기반의 애플리케이션도 있다. 이벤트 기반 아키텍처를 다른 아키텍처 스타일의 일부로 활용하는 아키텍처 스타일로는 마이크로서비스 아키텍처, 공간 기반 아키텍처가 대표적이다.

### 느낀 점
- 정말 복잡하다고 느꼈다. 이벤트 기반 아키텍처로 만들면 대부분의 시스템에 존재하는 회원 도메인을 외부 시스템에 영향을 주지 않고, 받지 않게 설계할 수 있다고 하는데 어떻게 그렇게 되는 건지 궁금하네요.