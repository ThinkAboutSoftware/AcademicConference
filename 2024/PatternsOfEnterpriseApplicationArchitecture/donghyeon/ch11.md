# ch11. 객체-관계형 동작 패턴

## 논의
JPA에서는 작업 단위 컨트롤러 방식을 사용하는데 사용하시는 ORM 프레임워크는 어떤 방식으로 작업 단위를 구현하나요?

## 내용
- 작업 단위(Unit of Work)
  - 한 비즈니스 트랜잭션 중 DB에 영향을 미치는 모든 변경 내용을 추적
  - 변경 내용 추적 방법
    - 호출자 등록: 객체의 호출자가 객체를 작업 단위에 등록
    - 객체 등록: 작업 단위에 등록하는 메서드를 객체 메서드로 구현
      - DB에서 최초 로드시 클린 객체로 등록
      - 객체 메서드(설정 메서드)에서 객체를 더티 객체로 등록
    - 작업 단위 컨트롤러: 읽을 때 클린 객체를 등록하고 복사본을 만듬. 이 후 커밋시점에 원본과 복사본을 비교
- 식별자 맵(Identity Map)
  - 단일 비즈니스 트랜잭션이 DB에서 읽은 모든 객체에 대한 기록을 보관
  - 객체가 필요할 때마다 식별자 맵에 객체가 있는지 확인 후 있으면 반환
  - 식별자 맵은 동시성 관리와 상호작용하므로 낙관적 오프라인 잠금도 고려해야 함
- 지연 로드(Lazy Load)
  - 데이터가 필요한 시점에 로드
  - 지연 로드 구현 방법
    - 지연 초기화(Lazy Initialization)
    - 가상 프락시(Virtual Proxy)
    - 값 홀더(Value Holder)
    - 고스트(Ghost)
  - 물결 로딩(Ripple Loading)을 조심해야 함
