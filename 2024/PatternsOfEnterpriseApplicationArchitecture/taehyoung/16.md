# 논의 내용

- 낙관적 잠금과 비관적 잠금을 언제 사용할지에 대한 문제는 사용자에게 재시도를 하게 할 것인지, 사용자에게 재시도 하지 않게 할 것인지에 따라 나눌 수 있겠다는 생각이 들었습니다. 업무에서 아직 낙관적 잠금을 활용해본적은 없는데 활용경험이 있다면 어떤 경우에 활용하였는지 얘기해보면 좋을 것 같습니다

# 낙관적 오프라인 잠금

- 낙관적 오프라인 잠금은 세션이 레코드를 로드한 이후 다른 세션이 이를 변경하지 않은 것을 확인함으로써 획득할 수 있다.
- 이를 구현하는 가장 일반적인 방법은 시스템의 각 레코드에 버전 번호를 연결하는 것
- 낙관적 동시성 관리는 두 비즈니스 트랜잭션 간에 충돌이 발생할 가능서이 낮은 경우 유용하다
- 비관적 잠금은 낙관적 잠금을 보완하는 방식으로 잘 작동하므로 어떤 경우에 낙관적 잠금을 사용해 충돌을 방지할지 고려하기 보다는 어떤 경우에 낙관적 잠금만으로는 부족한지 고려하는 것이 현명하다

# 비관적 오프라인 잠금

- 비관적 오프라인 잠금은 이러한 충돌을 미연에 방지한다 … 대상 데이터에 대한 잠금을 획득함으로써 일단 비즈니스 트랜잭션을 시작하면 동시성 제어 문제 때문에 작업이 실패하는 경우가 거의 없음을 확신할 수 있다.
- 올바른 잠금 유형을 선택할 때 고려할 사항은 시스템의 동시성 극대화, 비즈니스 요건 충족, 그리고 코드의 복잡성 최소화다
- 잠금을 획득할 수 없는 비즈니스 트랜잭션에 대한 가장 쉬운 대응은 작업을 취소하는 것이다. 비관적 오프라인 잠금에서는 트랜잭션 초기에 실패하므로 사용자가 큰 거부감 없이 받아들일 수 있다.
- 동시 세션 간의 충돌 가능성이 높은 경우 비관적 오프라인 잠금을 사용하는 것이 좋다. 사용자의 작업 내용이 버려지는 일이 있어서는 안 된다.

# 굵은 입자 잠금

- 굵은 입자 잠금은 여러 객체를 다룰 수 있는 단일 잠금이다. 굵은 입자 잠금을 사용하면 잠금 동작자체를 간소화 할 수 있으며, 그룹을 잠그기 위해 모든 멤버를 로드할 필요도 없어진다
- 굵은 입자 잠금을 사용하는 가장 중요한 이유는 당연히 비즈니스 요건을 충족하기 위해서다.

# 암시적 잠금

- 암시적 잠금을 구현한다는 것은 절대 생략할 수 없는 잠금 메카닉을 애플리케이션 프레임워크에서 자동으로 수행하도록 코드를 리팩터링한다는 의미다.
- 암시적 잠금은 프레임워크의 개념이 없는 가장 단순한 애플리케이션을 제외하고 반드시 사용해야한다. 잠금과 관련해서는 한 번의 작은 실수가 만들어내는 여파가 너무 크기 때문이다.