# 6장 세션 상태

# 논의 내용

- 각 상황 마다 적절한 세션 상태가 모두 다르겠지만, 최근에 개발 경험을 해봤을 때는 가능하면, 인증 같은 것도 JWT를 이용해서 상태 비저장으로 구현하려고 하고, 세션을 유지해야하는 상황이 있다면, 책에 나온대로 클라이언트 세션(쿠키나 로컬스토리지)이나 redis, 데이터베이스 세션을 사용했지, 서버 세션을 사용한적은 없었던 것 같습니다 혹시 다른 분들은 최근에 서버 세션을 사용해서 세션관리를 해본적이 있으신지 궁금합니다

# 키워드

1. 상태 비저장
2. 세션 마이그레이션(session migration)
3. 서버 선호도(server affinity)

# 내용 & 구조

## 개요

- 필자는 일부 세션은 본질적으로 상태 저장이라는 것을 인정하고 이 상태를 어떻게 처리해야 하는지 결정하는 것이 중요하다고 생각했다

## 상태 비저장의 가치

- 가장 우선적인 문제는 서버 리소스에 대한 것이다. 모든 상태 저장 서버 객체는 사용자가 웹 페이지를 보는 동안 대기하면서 모든 상태를 유지해야 한다
- 상태 비저장은 객체를 풀링해 훨씬 적은 수의 객체로 더 많은 사용자를 처리할 수 있게 해준다 유휴 사용자가 많을수록 상태 비저장 서버의 가치는 높아진다
- 상태 비저장 서버는 트래픽이 많은 웹사이트에 아주 유용하다 또한 HTTP가 상태 비저장 프로토콜이므로 웹과도 잘 맞는다
- 장바구니는 사용자의 전체 세션 동안 유지돼야 한다. 즉, 상태 저장 비즈니스 트랜잭션을 수행해야 하므로 세션도 상태 저장이어야 한다.

## 세션 상태

- 세션 상태는 커밋을 거쳐야 레코드 데이터가 된다.
- 세션 상태와 관련된 가장 중요한 문제는 격리성이다
- 세션 상태는 올바른 동작을 위해 요청 간에 저장해야 하지만 캐시는 손실되더라도 올바른 동작에 방해되지 않는다

## 세션 상태를 저장하는 방법

- 클라이언트 세션 상태
    - 데이터를 클라이언트에 저장
        - 쿠키
    - 저장해야하는 세션 상태의 양이 많으면 클라이언트 세션은 사용하지 않는 것이 좋다.
    - 보안과 무결성도 고려해야한다
    - 사용자가 세션을 취소하고 다시 돌아오지 않을수 있을 때, 적합하다
- 서버 세션 상태
    - 요청 간에 데이터를 메모리에 저장
        - 로컬파일 시스템, DB 테이블
- 데이터베이스 세션 상태
    - 데이터를 테이블과 필드로 분리하고 데이터베이스에 저장하는 방식
    - 클라이언트 강제 종료, 서버 오류, 그리고 네트워크 연결 실패 가 발생 했을 때 적합하다