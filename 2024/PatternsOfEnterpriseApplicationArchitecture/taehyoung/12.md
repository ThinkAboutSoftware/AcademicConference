# 12장 객체-관계형 구조 패턴

# 논의 내용

- 제가 사용했던 django 프레임워크의 경우엔 데이터베이스와 매핑되는 객체모델을 정의할 때, pk를 명시적으로 지정해주지 않으면 자동적으로 auto increment 하는 id 값을 생성하는 식으로 되어있어서, 의미 있는 키를 pk로 지정해서 사용해본적은 거의 없습니다 예전에 핸드폰 번호를 pk로 써보려는 시도를 해보려고 생각해본적은 있는데, 한 사람이 여러 핸드폰 번호를 가진 경우도 있다면(라이더들의 경우는 꽤나 많음), 제대로 식별자 역할을 할 수가 없습니다 이와 관련된 다른 분들의 경험이 있다면 궁금 합니다

# 식별자 필드

- 인메모리 객체와 데이터베이스 행 간의 식별자를 유지 관리하기 위해 데이터베이스 ID 필드를 저장하는 객체
- 식별자 필드는 관계형 데이터베이스의 기본 키를 객체의 필드에 저장하는 것이 전부다
- 키는 의미 있는 키와 의미 없는 키 사이에서 선택할 수 있는데, 주민등록번호, 강의번호와 같은 의미 있는 키가 실용적으로 보일 수 있지만, 잠재적인 데이터 무결성 문제가 발생할 수 있기 때문에, 의미 없는 키를 사용하여서 더 높은 신뢰성과 데이터베이스 무결성을 보장하게 된다. 개인적으로는 RDB 설계 시, 가능하면 의미 없는 키로 ID 값을 만들려고 하는데 그 이유는 모든 테이블을 의미 없는 키로 통일해서 쓴다고 했을 때, 키에 대한 예외가 없어서 인지하기 쉬웠기 때문이다
- 키 유형의 경우는 단순 키 혹은 복합 키에 대한 결정이 중요하고,테이블 내에서 고유한지 여부가 중요하다
- 키 생성의 경우 나는 기본적으로 자동 생성 방법을 가장 많이 사용한다
- 인 메모리 객체와 데이터베이스 행 간의 매핑이 있을 때 사용한다

# 외래 키 매핑

- 데이터베이스의 외래 키에 해당하는 개체의 ID 필드를 사용하여 데이터베이스에 저장하고, 데이터베이스에서 로드할 때 개체 관계를 보존한다
- 이 패턴을 사용하면 객체 지향 프로그래밍과 관계형 데이터베이스의 데이터 구조가 일치하지 않음에도 불구하고 객체 지향 모델을 관계형 데이터베이스 제약 조건 내에서 효율적으로 저장하고 관리할 수 있다.
- 흔히, django나 sql alchemy 같은 ORM 을 사용할 때, 자주 볼 수 있는데, 객체 참조를 테이블의 외래키를 통해서 매핑 할 수 있다
- 외래 키 매핑은 대부분의 클래스 간 연결에 사용할 수 있는데, 적용할 수 없는 가장 일반적인 경우는 다대다 연결이다. 제 1정규형에서는 단일 필드에 여러 외래 키를 저장할 수 없다고 규정하기 때문이다. 다대다 연결을 위해선 연관 테이블 매핑을 사용 해야한다

# 연관 테이블 매핑

- 객체는 컬렉션을 필드 값으로 사용해 다중 값 필드를 쉽게 처리할 수 있지만 관계형 데이터베이스에서는 단일 값 필드만 사용할 수 있다 특히, 다대다 연관의 경우는 외래 키를 포함할 단일 값 쪽이 없기 때문이다. 이때, 관계형 데이터베이스에서의 해결책은 관계를 기록하는 추가 테이블을 만드는 것이다 그후, 연관 테이블 매핑을 사용해 다중 값을 링크 테이블로 매핑하면 된다
- 링크 테이블에서 데이터를 로드 하려면 쿼리를 두번해야하는데, 매핑 테이블을 먼저 쿼리해서 ID값을 가져온 후, 그 ID를 기준으로 다른 테이블을 조회하는 것이다. 이는 쿼리를 불필요하게 사용할 수 있기 때문에, 조인을 통해서 단일 쿼리로 변경할 수 있다
- 연관 테이블 매핑의 표준적인 용도는 다대다 연관 관계를 나태내는 것이다