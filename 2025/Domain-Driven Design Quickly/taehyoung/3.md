# 3장 모델 주도 설계

# 논의 내용

1. 책에서 절차지형적인 코드는 복잡한 도메인을 표현하기에 한계가 있다고 설명하고 있습니다. 실제 제가 경험해보거나 주변에서 들어본 사례를 보면, 각 회사들의 production에서 운영중인 비즈니스 로직 코드들을 보면, 도메인이 복잡한 것과 별개로, 거의 대부분 트랜잭션 스크립트로 작성 되어 있습니다. 객사오, 오브젝트 같은 책들을 좋다는 개발자들은 많이 봤지만, 정작 작성하는 코드들은 객체지향적이지 않은 코드들이 거의 대부분이였던 것 같습니다. 혹시 저말고 다른 분들도 비슷한 경험이신지 궁금하고, 이유가 무엇일지? 에 대해서도 의견을 부탁 드립니다 아래는 제가 생각해본 이유 입니다
    - 이유
        - 첫째, 각 회사들의 비즈니스로직이 트랜잭션 스크립트 만으로도 표현이될 만큼 충분히 복잡하지 않기 때문일까?
        - 둘째, 아니면, 개발자들이 도메인 객체들을 활용한, 객체지향 코딩을 할만한 역량이 갖춰지지 않았기 때문일까?
2. 집합(aggregate) 객체를 책에 나오는 불변식(invariant)과 root 개념을 활용하여서, 현업에서도 잘 설계해서 사용하고 계신지 궁금합니다 사례가 있다면 공유해주시면 좋을 것 같습니다
3. 본인이 생각하는 서비스 객체의 역할은 무엇인지 얘기 보면 좋을 것 같습니다
4. 서비스 객체의 오남용 사례에 대해서 본인이 겪은 일이 있는지 얘기해보면 좋을 것 같습니다
5. 서비스 라는 이름이 과연 적절한 표현인가에 대한 본인의 의견이 있다면, 의견 부탁 드립니다
    

# 키워드

1. 계층형 아키텍쳐
2. 엔티티
3. 값객체
4. 서비스
5. 모듈
6. 집합
    1. 불변식
    2. root
7. 팩토리
8. 리파지토리

# 내 생각

1. 책에서는 복잡한 프로그램의 유지보수성과 테스트 가능성을 높이기 위한 해결책으로, 레이어를 나누는 것을 제안하고 있다 이를 흔히 레이어드 아키텍쳐 라고 한다 나는 이 의견에 매우 동의 한다 하지만 얼만큼 어떻게 나눌 것인가는 논쟁거리가 될 수 있다고 생각한다. 각 개인마다 본인의 경험과 맥락에서 정해진 상대적 기준들이 있기 때문이다. 그래서 흔히들 얘기되는것은 레이어드 아키텍쳐, 헥사고날 아키텍쳐 등등인데, 개인적으로 책에서 말하는 내용을 정답이라고 생각해서는 안된다고 생각한다 그 이유는 책에서는 복잡한 도메인을 코드로 표현해야한다는 전제가 깔려 있기 때문이다. 반대로 생각해보면, 복잡하지 않다면, 위의 아키텍쳐들을 굳이 따를 필요가 없다고 생각한다. 또한 이 코드가 정말로 한번 개발된 이후에 다시 수정될 일이 없다면, 역시나 위의 아키텍쳐를 따를 필요가 없다고 생각한다. 우리가 무의식적으로 말하는 확장성을 고려한 설계와 코드, 아키텍쳐 같은 것들이 정말로 현재 내 업무 도메인에 적합한 것인지는 반드시 고민해봐야하는 문제이고, 무작정 클린아키텍쳐나 헥사고날 같은 것들을 도입하자고 말하지 않아야한다. 정말로 클린아키텍쳐와 헥사고날이 필요할 만큼 유지보수성과 테스트 가능성, 확장성을 고려할만하다고 판단될 때 활용하도록 해야한다고 생각한다
2. 서비스 라는 용어가 업계에서 오남용되고 있는 용어 중에 하나라고 생각 한다. 이유는 각 사람들마다 이 용어를 받아들이고 사용하는 기준이 다 다르다고 느꼈기 때문이다. Service 가 정말로 무엇인지, 왜 Service 라는 접미어를 붙여서 클래스를 만들어야하는지, @Service 애노테이션을 붙이는 기준은 무엇인지? 등등 관련된 질문을 속시원하게 답변해주는 사람을 아직까지 만나 보지 못하였다. 가장 흔한 답변은 controller 가 의존하고 있는 비즈니스로직이 구현된 공간이라는 정도이고, 대략 그냥 비즈니스로직 작성하는 객체라고 많이들 부르는 것 같다. 여기서 말하는 비즈니스 로직 이라는 것도, 각 개발자 마다 생각하는 범위가 다르다보니, 이 내용을 해석하는 개발자의 생각도 제각각이고, 이로인해서, 수많은 정체모를 서비스 객체들이 만들어지게 되고, 여기에 @Service 애노테이션을 붙이는게 맞냐 아니냐, Service 객체끼리 의존성을 가지는게 맞는 것인가?, 도메인 서비스는 도메인의 서비스 이기 때문에, POJO 형태로 되어야한다, 아니다 상황에 따라서 리파지토리를 의존하는 경우도 있다 등등의 수많은 논란이 있다고 생각한다.(파이썬 진영에서는 자바 스프링과 별개로 또 다르게 해석하는 경우를 많이 보았는데, 이는 python business logic, service layer 등등의 검색어를 찾아봐도 쉽게 찾을 수 있다) 이런 오남용 사례가 쌓이면서, 결국에는 명시적으로 서비스가 무엇이다라고 정의 하지 못하고, 대략 감으로 이건 서비스이다 아니다 정도로만 판단하고 코드를 작성하는게 현실이지 않나? 라는 생각이다
3. 그래서 개인적으로는 서비스의 역할을 다음과 같이 구분을 한다.
    1. 트랜잭션 스크립트를 작성할 때,
        1. 비즈니스 로직을 어떤 작업 절차  단위로 적절히 나눠서, 작성하는 곳
            1. 이때의 작업 절차 단위는 private method로 작성 할 수도 있고,(로직이 간단하다면,) 로직이 간단하지 않다면, 별도의 이를 구현하는 하위 객체를 생성해서도 작성할 수 있을 것으로 보인다
    2. 도메인 객체를 활용한 객체지향적인 코드를 작성할 때,
        1. 도메인 객체, 리파지토리 객체, 값 객체, 등등 여러 객체들을 모아서 조정(coordination)하는 역할 이라고 하고, 이를 애플리케이션  서비스라 부른다. java spring 기준으로 봤을 때는 controller가 의존하는 객체이어야 하고, @Service 애노테이션이 붙어야한다
        2. 어떤 로직을 도메인 객체의 어떤 부분에도 넣기 애매할 때, 도메인 객체의 서비스 라는 의미로 도메인 서비스 객체라 부른다 위의 애플리케이션 서비스와 다르게, 계층 구조상으로 애플리케이션 서비스가 도메인 서비스를 의존하는 형태이기 때문에, 이때 @Service 애노테이션은 붙이지 않아야 한다 의존성 주입이 필요하다면, 대신 다른 애노테이션을 붙여야한다(예를 들면, @Component)
            1. `자바/스프링 개발자를 위한 실용주의 프로그래밍` 책을 보면, 도메인 서비스의 경우는 다시 도메인 객체로 치환할 수 있음을 말하는데(책 기준 도메인 서비스를 PriceManager 라는 객체로 예를 든다), 이부분은 설계의 문제이다. 즉, 도메인 모델링을 좀 더 상세히 고민해봄으로써, 도메인 서비스를 별도의 도메인 객체로 다시 설계 할 수 있다
4. 모듈의 경우, 요즘 국내의 java spring 트렌드를 봤을 때, 멀티모듈 등으로 많이 언급되는 것으로 알고 있고, 패키지 이상의 무언가를 의미하는 것으로 알고 있는데, 책에서는 패키지 정도 수준에서 설명하는 것 처럼 느껴졌다
5. 집합에 대해서 책에 길게 설명이 나오는데, 간단히 말하면, 엔티티의 수정이 필요할 때, 수정을 위한 인터페이스를 제공하는 어떤 객체들의 집합이라고 말할 수 있고, 이 객체들의 집합은 수정 시에 한 트랜잭션으로 묶여서 동작되어야만 한다. 책에 집합 root 라는 것이 나오는데, 이 root는 직접적으로 인터페이스를 제공하는 객체이며, 이 객체를 통해서만 수정이 가능하도록 하는게 집합을 사용하는, 집합을 설계하는 목적이다. 책에 불변식이라는 말도 나오는데, 이 root에서 불변식을 가지고 있고, 수정 전에 root 단에서 불변식을 체크하도록 한다. 정리하면, 어떤 엔티티의 수정이 필요할 때, 불변식을 가지고 있는 root 엔티티가 제공하는 인터페이스를 호출을 하여서, 집합으로 묶인 객체들을 한 트랜잭션 내에서, 수정할 수 있게 하는 어떤 것이라고 말할 수 있다
    1. 책의 예제 기준으로 설명하자면, ContactInfo 정보 중 하나를 수정하고 싶은 경우에 흔히 ContactInfo에 직접 접근하거나, ContractInfo의 별도 인터페이스를 통해서 값을 수정할 수 있다고 생각을 하는데, 집합은 의도적으로 ContactInfo의 값을 수정하기 위해, ContractInfo를 수정 이전에 체크가 필요한 불변식을 가지고 있는, root 엔티티의 인터페이스로만 수정할 수 있도록 한다. 즉, 수정할 수 있는 경로에 제한을 두는 것이다
6. 팩토리와 리파지토리의 경우는 책에서 나온 것과 같이 리파지토리 쪽은 영속성과 관련된 객체, 팩토리는 메모리 상에서 만들어지는 객체의 생성과 관련된 것으로 이해하는게 좋다고 생각을 하였다