# 5장 모델 무결성 보존
이 장에서는 여러 팀의 공동 작업이 필요한 대규모 프로젝트를 다룬다. 서로 다른 관리와 협조 체계 아래서 일하는 다수의 팀들이 하나의 프로젝트를 할 때 다양한 도전에 직면하게 된다.

모델의 일부분을 할당 받아 각 팀이 작업을 하면 이 할당 받은 부분들은 독립적이지 않고 서로 연관된 부분도 존재한다. 이런 방식은 자신의 영역은 잘 알고 있지만 다른 영역은 잘 모르기 때문에 문제가 발생 가능하다. 모듈을 서로 사용하는 시점에 자신의 팀의 모듈을 수정하게 되면 전체 시스템에 영향을 준다. 그런데 다른 팀들은 해당 모듈에 대해 잘 알지 못하기 때문에 문제 발생을 알아차리기 어렵다.

이를 해결하기 위한 접근법으로 결국에 쪼개질 하나의 큰 모델을 유지하려고 하는 대신에 의도적으로 이것을 여러 개의 모델로 분할하는 것이다. 이 모델들은 각각 지켜야 하는 계약을 준수해야하고 서로의 경계가 명확히 구분되며 관계는 정밀하다. 이것이 모델의 무결성을 유지하는 방법이다.


**분할된 컨텍스트**  
컨텍스트는 특정 도메인 내에서의 의미, 규칙, 관계 등이 일관되게 정의되고 적용되는 범위를 말한다. 예시로 온라인 쇼핑몰의 경우 주문 컨텍스트, 고객 컨텍스트, 재고 컨텍스트로 나눌 수 있고 각각의 컨텍스트는 다른 모델을 갖는다.

대규모 기업 시스템을 개발할 때는 각 모델에 대해 컨텍스트를 정의할 필요가 있다. 이유는 팀 간 개발할 모델을 맡고 일관성, 통일성을 유지해 개발하여 모델들 사이에 의사소통을 원활하게 하기 위함이다.

여러 모델로 분할하기 위해서는 모델간의 경계와 관계를 정의해야한다.


**지속적인 통합**  
한번 분할된 컨텍스트가 정의되고 나면 이것을 건강한 상태로 유지해야 한다. 하나의 팀이 분할된 컨텍스트에서 일하더라도 객체간의 관계를 이해하지 못하면 중복된 코드를 추가할 수도 있어 명확하고 지속적인 의사소통이 필요하다. 

모델은 초기부터 충분하게 정의될 수 없다. 모델은 생성되면 개발 프로세스 과정에서 끊임 없이 도메인에 대한 이해를 바탕으로 피드백 된다.


**컨텍스트 맵**  
기업규모 애플리케이션은 다수의 모델을 가지며 각 모델은 고유의 분할된 컨텍스트를 갖는다. 이러한 컨텍스트는 팀 구조를 잡는 기초로 사용하기에 유용하다. 같은 팀에 속한 사람들은 좀 더 쉽게 의사소통이 가능하고 모델과 구현을 통합하는 일을 더 잘할 수 있다.

컨텍스트 맵을 통해 서로 분할된 컨텍스트 사이의 관계에 대한 개요를 나타내어 전체를 인식하는데 용이하다. 상세 정보는 인식하기 어렵지만 프로젝트의 모든 사람이 하나의 컨텍스트 맵을 공유하고 이해하는게 중요하다.

컨텍스트 간의 상호작용을 명확히 표현하기 위한 몇 가지 패턴들이 존재하는데 공유 커널과 고객-공급자 패턴은 컨텍스트 간의 상호작용이 높을 때 사용하고, 분할 방식은 독립성을 높이고 관계를 분리하고 싶을 때 사용하는 패턴이다. 시스템, 레거시 시스템, 외부의 어떤 것과의 상호작용에 있어 사용하는 패턴은 오픈 호스트 서비스와 변질 방지 레이어가 있다.


**공유 커널**  
서로 밀접하게 관련이 있지만 협조가 되지 않는 팀은 한동안 앞으로 달려갈 수 있지만 결과물이 들어 맞지 않게 될 수 있다. 이는 지속적으로 통합해 유지하는 유비쿼터스 언어의 장점을 잃어버릴 수도 있다.

공유 커널은 두 컨텍스트 간에 상호작용을 높이기 위한 방법으로 도메인 모델의 일부를 두 팀이 공유하는 방식으로 이루어진다. 다른 팀과 협의 하에 테스트를 통해 통합이 된다.


**고객-공급자**  
두 서브 시스템 한쪽이 다른 한쪽에 완전히 의존하는 경우 고객-공급자 관계를 갖는다. 공급자 시스템은 고객 시스템에게 필요한 명세를 구현해야 하며 이것이 두 서브 시스템 연결의 한 유형이 된다. 

이 두 서브 시스템 간의 인터페이스는 정교하게 정의되어야 하고 요구 사항이 준수 될 때마다 테스트가 진행되어야 한다.


**순응**  
고객-공급자 관계는 양쪽 팀이 관계에 관심 있을 때 성공할 수 있다. 고객은 공급자에 대해 매우 의존적이지만 공급자는 그렇지 않다. 전체를 관리하는 관계자가 존재하면 공급자가 주의를 기울이고 고객의 요구 사항을 듣게 할 수 있지만 존재하지 않다면 공급자가 주의를 덜 쓰게 되는 상황에 놓이게 된다.

순응(comformity)이란 고객이 공급자 팀의 모델을 사용해야만 하고 그것이 잘 된 모델인 경우이다.


**변질 방지 레이어**  
레거시 소프트웨어와 상호작용이 필요한 애플리케이션을 만들 때 변질 방지 레이어를 사용한다. 레거시 소프트웨어는 기존 모델의 개념과 다르기 때문에 이를 일정수준으로 통합하기 위해서 중간에 변질 방지 레이어가 필요하다.

변질 방지 레이어는 양 모델 간의 번역자 역할을 하며 클라이언트 모델이 외부로부터 오염을 받지 않게 된다.


**분할 방식**  
분할 방식 패턴은 기업 어플리케이션을 몇 개의 어플리케이션으로 쪼개어 개발할 때 사용하며 이는 통합의 가치가 파생되는 문제보다 작을 경우이다 . 이 쪼개진 어플리케이션 간에는 공통적인 것이 없어야 한다.


**오픈 호스트 서비스**  
외부 서브시스템이 여러 개의 클라이언트 서브시스템에 의해 사용된다면 전체를 위한 번역 레이어를 만들 필요가 있다. 외부 서브시스템을 서비스로 감쌀 수 있다면 모든 다른 서브 시스템이 서비스를 통해서만 접근하므로 번역 레이어가 필요하지 않게 된다. 하지만 각 서브시스템이 외부 서브시스템과 특별한 방식으로 상호작용을 하면 일관성에 있어 어려움이 발생한다.

위를 해결하기 위해서는 자신의 시스템에 접근할 수 있는 프로토콜을 서비스의 집합으로 정의한다. 단일팀에 한정된 예외적 요구사항을 제외하고 새로운 요구사항을 통합할 수 있도록 프로토콜을 통합하고 발전시킨다.


**증류**  
증류(Distillation)는 혼합체를 구성하고 있는 물질을 분리해 내는 절차다. 목적으로는 혼합체로부터 특별한 물질을 분리하기 위함이다.

도메인의 규모가 크다면 이를 재정의하고 추상화 작업을 거쳐도 대규모 모델인 경우가 많다. 이때가 증류 작업이 필요한 시점이다. 도메인의 정수를 표현하는 핵심 도메인을 정의해야 한다. 도메인을 증류 할 때 생기는 부산물은 도메인의 다른 파트를 구성하는 일반 서브도메인이다.